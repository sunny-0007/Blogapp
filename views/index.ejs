<%- include('partials/header') %>

<!-- MAIN CONTENT - SHOW TO EVERYONE -->


<% if (posts.length === 0) { %>
  <!-- EMPTY STATE - Shown to BOTH guests AND logged-in users with no posts -->
  <div class="empty-state-container">
    <div class="empty-state-box">
      <h1>Create Your First Post</h1>
      <p>Start sharing your thoughts with the new world</p>
    </div>
    <div class="empty-state-button">
      <% if (user) { %>
        <!-- Logged in → can create post -->
        <a href="/create" class="btn btn-lg">Create One</a>
      <% } else { %>
        <!-- Not logged in → show login button -->
        <a href="/login" class="btn btn-lg">Login to Start Writing</a>
      <% } %>
    </div>
  </div>

<% } else { %>
  <!-- POST LIST - Only show if there are posts AND user is logged in -->
  <% if (user) { %>
    <h2 class="page-title">All Posts</h2>
    <% posts.forEach(post => { %>
      <div class="card">
        <h3>
          <a href="/post/<%= post._id %>" style="color: #2c3e50; text-decoration: none;">
            <%= post.title %>
          </a>
        </h3>
        <p>
          <small>
            <%= new Date(post.createdAt).toLocaleDateString('en-US', {
              year: 'numeric', month: 'long', day: 'numeric'
            }) %>
          </small>
        </p>
        <div>
          <%- post.content.substring(0, 150) %>...
          <a href="/post/<%= post._id %>">Read More</a>
        </div>
        <br />
        <a href="/edit/<%= post._id %>" class="btn">Edit</a>
        <form action="/delete/<%= post._id %>" method="POST" style="display: inline;">
          <button type="submit" class="btn danger"
                  onclick="return confirm('Delete this post?')">
            Delete
          </button>
        </form>
      </div>
    <% }); %>
  <% } else { %>
    <!-- User is logged out BUT there ARE posts → hide them, show empty state -->
    <div class="empty-state-container">
      <div class="empty-state-box">
        <h1>Create Your First Post</h1>
        <p>Start sharing your thoughts with the new world</p>
      </div>
      <div class="empty-state-button">
        <a href="/login" class="btn btn-lg">Login to View & Create Posts</a>
      </div>
    </div>
  <% } %>
<% } %>

<%- include('partials/footer') %>